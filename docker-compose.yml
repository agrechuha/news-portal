version: '3'

networks:
  app-network:
    driver: bridge
services:
  apache-news:
    image: httpd:2.4-alpine
    container_name: 'apache-news'
    restart: always
    ports:
      - '${HOST_MACHINE_UNSECURE_HOST_PORT}:80'
    volumes:
      - ./:/var/www/html
      - ./docker/conf/apache/httpd.conf:/usr/local/apache2/conf/httpd.conf
    depends_on:
      - php-news
    networks:
      - app-network
  php-news:
    build:
      context: ./docker/bin/php
      dockerfile: Dockerfile
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      XDEBUG_CONFIG: "remote_host=192.168.220.1 remote_enable=1"
      PHP_IDE_CONFIG: "serverName=Docker"
      PHP_ENABLE_XDEBUG: 1
      XDEBUG_MODE: "debug"
    container_name: 'php7.2'
    restart: always
    volumes:
      - ./:/var/www/html
      - ./docker/conf/php/php.ini:/usr/local/etc/php/php.ini
    depends_on:
      - mysql-news
    networks:
      - app-network
  mysql-news:
    image: mysql:5.7
    container_name: 'mysql5.7-news'
    restart: always
    ports:
      - "${HOST_MACHINE_MYSQL_PORT}:3306"
    volumes:
      - '${MYSQL_DATA_DIR}:/var/lib/mysql'
      - '${MYSQL_LOG_DIR}:/var/log/mysql'
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
    networks:
      - app-network
  phpmyadmin-news:
    image: phpmyadmin/phpmyadmin
    container_name: 'phpmyadmin-news'
    restart: always
    links:
      - mysql-news
    ports:
      - '${PHPMYADMIN_PORT}:80'
    volumes:
      - /sessions
    environment:
      PMA_HOST: mysql
      PMA_PORT: 3306
      PMA_USER: ${MYSQL_USER}
      PMA_PASSWORD: ${MYSQL_PASSWORD}
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
    depends_on:
      - mysql-news
    networks:
      - app-network